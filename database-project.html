<!DOCTYPE HTML>
<html>
	<head>
		<title>Shopping Cart Database Project â€” aaronguan.</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />
        <link rel="shortcut icon" href="icon.jpg">
	</head>
	<body>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<h1><a href="index.html">HOME</a></h1>
						<nav class="links">
							<ul>
								<li><a href="about.html">ABOUT ME</a></li>
								<li><a href="things-i-saw.html">THINGS I SAW</a></li>
								<li><a href="things-i've-made.html">THINGS I HAVE MADE</a></li>
                                <li><a href="things-i-wanna-say.html">THINGS I WANNA SAY</a></li>
								<li><a href="other-thing.html">OTHER THINGS</a></li>
							</ul>
						</nav>
						<nav class="main">
							<ul>
								<li class="menu">
									<a class="fa-bars" href="#menu">Menu</a>
								</li>
							</ul>
						</nav>
					</header>

				<!-- Menu -->
					<section id="menu">
						<!-- Links -->
							<section>
								<ul class="links">
									<li>
										<a href="about.html">
											<h3>ABOUT ME</h3>
											<p>Come to know more about me</p>
										</a>
									</li>
									<li>
										<a href="things-i-saw.html">
											<h3>THINGS I SAW</h3>
											<p>Lovely things I captured in the world</p>
										</a>
									</li>
									<li>
										<a href="things-i've-made.html">
											<h3>THINGS I HAVE MADE</h3>
											<p>Some interesting things I created</p>
										</a>
									</li>
									<li>
                                        <a href="things-i-wanna-say.html">
                                            <h3>THINGS I WANNA SAY</h3>
                                            <p>I'd like to say something</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="other-thing.html">
                                            <h3>OTHER THINGS</h3>
                                            <p>Some little things I wanna write down</p>
                                        </a>
                                    </li>
								</ul>
							</section>

					</section>
                    <div class="copyrights">
						&copy; Aaron Guan. All rights reserved. Design: <a href="http://www.aaronguan.com/">Aaron Guan</a>.
					</div>
                <div id="toc_wrapper">
                <section id="toc_container">
                    <p class="toc_title">Table of Contents</p>
                    <ul class="toc_list">
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#description">Database Description</a></li>
                        <li><a href="#SQL">SQL and Database</a></li>
                        <li><a href="#javaGUI">Java GUI</a></li>
                        <li><a href="#end">The Thing You Don't Wanna Miss</a></li>
                    </ul>
                </section>
                </div>
                <div id="toc_container_nav">
                    <button class="dropdown-button">Table of Content<i class="fa fa-caret-down"></i></button>
                    <div class="dropdown-content">
                        <ul>
                            <li><a href="#overview">Overview</a></li>
                            <li><a href="#description">Database Description</a></li>
                            <li><a href="#SQL">SQL and Database</a></li>
                            <li><a href="#javaGUI">Java GUI</a></li>
                            <li><a href="#end">The Thing You Don't Wanna Miss</a></li>
                        </ul>
                    </div>
                </div>
				<!-- Main -->
					<div id="main">
                        <div id="post-toc-wrapper">
						<!-- Post -->
							<article class="post">
								<header>
									<div class="title">
										<h2>Shopping Cart Database Project</h2>
										<p>The Hong Kong Polytechnic University</p>
									</div>
								</header>
								<img class = "image fit" src="images/database/ER.PNG" alt="" />
								<p id="overview">I've taken ECSE421-Database System course at McGill University and the project of this course required students to develop and build a database application for a real-world domain. We designed a schema, created a database using PostgreSQL, populated our database with data, maintained, queried and updated our data, developed application programs, and implemented a user-friendly interface by Java.</p>
								<p>Our group's application is an online platform for users to purchase or sell their electronics products. The application allows both buyer and seller to register as the user. The seller can open stores to sell electronic devices and the buyer can purchase products based on shopping cart module. The database is build based on the basic function including querying products, adding to the shopping cart, and performing payment, etc. Actually, we used TaoBao as a reference and we limit our sphere of interest to electronics sales website and consider C2C E-commerce application.</p>
								<h2 id="description">Database Description</h2>
                                <!-- Entities -->
                                <div class="6u$ 12u$(medium)">
                                    <ol>
                                        <i><h6><li>Entities and attributes</li></h6></i>
                                <div class="6u 12u$(medium)">
                                    <ul>
                                        <li><i><b>User (<u>userId</u>, name, phoneNum)</b></i><p>A user is someone who has registered an account for this website. A user could be either buyer or seller and is associated with several attributes including name, phone number and email address. It is identified by a unique primary key called <i>userId</i>.</p></li>
                                        <li><i><b>Buyer (<u>userId</u>)</b></i><p>A buyer is someone who will buy something on the website and it is a subcategory of the user entity. It inherits all the features of a user.</p></li>
								<li><i><b>Seller (<u>userId</u>)</b></i>
								<p>A seller is someone who has opened a store on the website and it is a subcategory of the user entity. It inherits all the features of a user.</p></li>
								<li><i><b>Bank Card (<u>cardNumber</u>, userId, bank, expiryDate)</b></i>
								<p>A bank card is either a credit card or a debit card depends on whether is used for buyers to pay or is used for sellers to receive the payment. The database records bank to which the card belongs, the expiry date of the card, and the card number which is also the primary key of this entity.</p></li>
								<li><i><b>Credit Card (<u>cardNumber</u>, organization)</b></i>
								<p>A credit card is a subcategory of the bank card entity. it inherits all the features of bank card and supports its own attributes organization</p></li>
								<li><i><b>Debit Card (<u>cardNumber</u>)</b></i>
								<p>A debit card is also a subcategory of the bank card entity. It also inherits all the features of a bank card.</p></li>
								<li><i><b>Store (<u>sid</u>, name, startTime, customerGrade, streetAddr, city, province)</b></i>
								<p>A store is an online shop managed by a seller. The database keeps track of the time when the store opened, the name of the store, the address where the store located, and the customer reviews. It can be identified by its unique primary key named <i>sid</i>.</p></li>
								<li><i><b>Product (<u>pid</u>, sid, name, brand, type, amount, price, colour, customerReview, modelNumber)</b></i>
								<p>A product is an item to be sold by a seller. A product is recorded in the database with its name, price, category, colour, model number, inventory, and the customer review. A product can be identified by its primary key called <i>pid</i>.</p></li>
								<li><i><b>Order Item (<u>itemid</u>, pid, price, creationTime)</b></i>
								<p>An order item is a product that a buyer has already ordered and waiting for payment. The database keeps track of the time and the price when the item has been ordered. An order item can be identified by its order number.</p></li>
								<li><i><b>Order (<u>orderNumber</u>, creationTime, paymentStatus, totalAmount)</b></i>
								<p>An order is a list of products that the buyer has already ordered. An order contains an order number, the time when the order is created, the payment status, and the total amount. An order can be identified by its primary key called <i>orderNumber</i>.</p></li>
								<li><i><b>Address (<u>addrid</u>, userid, name, city, postalCode, streetAddr, province, contactPhoneNumber)</b></i>
								<p>An address is a location to which the purchased products are delivered. It is provided by the buyer and each of addresses has its own city, street address, province, postal code, and the contact number attributes. Each of addresses can be identified by a primary key called <i>addrid</i>.</p></li>
                                    </ul>
                                </div>
                                <!-- Relationship -->
                                        <i><h6><li>Relationship</li></h6></i>
                                        <div class="6u 12u$(medium)">
                                            <ul>
								<li><i><b>Manage (<u>userid, sid</u>, SetupTime) (userid ref Seller, sid ref Store)</b></i>
								<p>A store is managed by a seller. This is a one-to-many relationship since a seller can manage multiple stores, but one store can only be managed by one seller.</p></li>
								<li><i><b>Save to Shopping Cart (<u>userid, pid</u>, quantity, addtime) (userid ref Buyer, pid ref Product)</b></i>
								<p>A buyer saves a product to shopping cart. This is a many-to-many relationship because a buyer can order more than one product item or even do not order product, and a product can be ordered by multiple buyers. This relationship also has attributes including the time when the product be ordered and the quantity of the product that the buyer ordered.</p></li>
								<li><i><b>Contain (<u>orderNumber, itemid</u>, quantity) (orderNumber ref Order, itemid ref Order Item)</b></i>
								<p>An order item is contained in an order. This is a one-to-many relationship since an order item should belong to only one order while one order can contain multiple order items. This relationship has an attribute indicating the quantity of the order item.</p></li>
								<li><i><b>Deliver To (<u>addrid, orderNumber</u>, TimeDelivered) (addrid ref Address, orderNumber ref Order)</b></i>
								<p>An order is delivered to an address. This is a one-to-many relationship because an order can only be delivered to one address location while one address can have multiple orders.</p></li>
								<li><i><b>Payment (<u>C.cardNumber, orderNumber</u>, payTime) (C.cardNumber ref Credit Card, orderNumber ref Order)</b></i>
								<p>An order is paid by a credit card. This is one-to-many relationship. A credit card can pay for multiple orders while an order can only be paid by one credit card. This relationship has an attribute indicating the time when the payment is settled.</p></li>
                                            </ul>
                                        </div>
                                    </ol>
                                </div>
                                <h2 id="SQL">SQL and Database</h2>
                                
								<div class="6u$ 12u$(small)">
								<ol> 
                                    <i><h6><li>Create Database Schema</li></h6></i>
                                    <p><code>CREATE TABLE</code> is used to create both entity and relationship. For example:</p>   
								<pre><code>CREATE TABLE Save_to_Shopping_Cart
(
    userid INT NOT NULL
    ,pid INT NOT NULL
    ,addTime DATE
    ,quantity INT
    ,PRIMARY KEY (userid,pid)
    ,FOREIGN KEY(userid) REFERENCES Buyer(userid)
    ,FOREIGN KEY(pid) REFERENCES Product(pid)
);</code></pre>
                                     <a href="http://aaronguan.com/Table.sql" class="button icon fa-download" download>Table.sql</a>
                                    <br>
                                    <br>
                                    <i><h6><li>Insert Data</li></h6></i>
                                    <p><code>INSERT INTO...VALUE..</code> is used to insert data into table. For example:</p>
                                    <pre><code>INSERT INTO "users" (userid,name,phoneNumber) VALUES 
(1,'Leonard Carroll','809-902-4957');</code></pre>
                                    <a href="http://aaronguan.com/Insert.sql" class="button icon fa-download" download>Insert.sql</a>
                                    <br>
                                    <br>
								<h6><i><li>Data Modification</li></i></h6>
                                    
                                    <p><code>DELETE</code> and <code>UPDATE</code> are usually used to modify the data in the database.</p><p><code>CREATE VIEW</code> is used to create virtual table based on the result-set of an SQL statement.</p> 
                                    <p><code>CHECK</code> constraint is used to limit the value range that can be placed in a column.</p>
                                    For example:
                                    <pre><code>-- Update the payment state of orders to unpaid 
which created after year 2017 and with total amount greater than 50.
UPDATE Orders
SET paymentState = 'Unpaid'
WHERE creationTime > '2017-01-01' AND totalAmount > 50;

-- Delete the store which opened before year 2017
DELETE FROM save_to_shopping_cart
WHERE addTime &lt; '2017-01-01';

-- Create view of all products whose price above average price.

CREATE VIEW Products_Above_Average_Price AS
SELECT pid, name, price 
FROM Product
WHERE price > (SELECT AVG(price) FROM Product);

-- Check whether the ordered item has 0 to 10 quantities
CREATE TABLE Contain
(
    orderNumber INT NOT NULL
    ,itemid INT NOT NULL
    ,quantity INT CHECK(quantity &gt; 0 AND quantity &le;  10)
    ,PRIMARY KEY (orderNumber,itemid)
    ,FOREIGN KEY(orderNumber) REFERENCES Orders(orderNumber)
    ,FOREIGN KEY(itemid) REFERENCES OrderItem(itemid)
);
INSERT INTO Contain VALUES (76023921,23543245,11); -- It would cause error
</code></pre>
                                    <a href="http://aaronguan.com/Modification.sql" class="button icon fa-download" download>Modification.sql</a>
                                    <br>
                                    <br>
                                    <h6><i><li>Procedural Statements</li></i></h6>
                                    <p>Stored procedure and user-defined function (UDF) is a set of SQL and procedural statements (declarations, assignments, loops, flow-of-control etc.) that stored on the database server and can be invoked using the SQL interface. In PostgreSQL, both stored procedures and user-defined functions are created with <code>CREATE FUNCTION</code>statement.</p>
                                    <p>The stored procedure we designed is to compute the average amount of a brand in the <i>'product'</i> and then use this value to modify the quantity of a product in <i>'save_to_shopping_cart'</i> table.</p>
                                    <pre><code>-- STORED PROCEDURE
CREATE FUNCTION func1 (vpid integer, vbrand character varying) RETURNS integer
LANGUAGE plpgsql
AS $$
DECLARE
v_amount INTEGER;
C1 CURSOR FOR SELECT AVG(amount) FROM product WHERE brand = vbrand;
BEGIN
OPEN C1;
FETCH C1 INTO v_amount;
UPDATE save_to_shopping_cart SET quantity = v_amount WHERE pid = vpid;
RETURN v_amount;
CLOSE C1;
END
$$</code></pre>
                                    <p>Use <code>SELECT</code> to invoke the stored procedure. For example: <code>SELECT fun1(8,'Microsoft')</code> will return the average amount of the Microsoft products in the <i>'product'</i> table and also update the quantity of the product whose pid is 8 in the <i>'save_to_shopping_cart'</i> table.</p>
								<p>We also created a trigger associated with this procedure. Whenever the quantity of a product in the <i>'save_to_shopping_cart'</i> changes, we will log it into a separate table named <i>'shoppingcart_audits'</i> by this trigger.</p>
								<p>First, we created the <i>'shoppingcart_audits'</i> table and the trigger function.</p>
								<pre><code>-- TRIGGER PROCEDURE
CREATE TABLE shoppingcart_audits(
id SERIAL PRIMARY KEY,
userid INT NOT NULL,
pid INT NOT NULL,
quantity INT NOT NULL,
changed_on TIMESTAMP(6) NOT NULL
);

CREATE OR REPLACE FUNCTION shoppingcart_quantity_changes()
RETURNS TRIGGER AS $$
BEGIN
IF NEW.quantity &lt;&gt; OLD.quantity THEN
INSERT INTO shoppingcart_audits (userid, pid, quantity,changed_on)
VALUES ( OLD.userid, OLD.pid, OLD.quantity, now());
END IF;
RETURN NEW;
END;
$$ LANGUAGE 'plpgsql';</code></pre>
								<p>Second, we bind the trigger function to the <i>'save_to_shopping_cart'</i> table by <code>CREATE TRIGGER</code>. Whenever the quantity is updated in the shopping cart, the trigger function would be automatically invoked to store the changes to the <i>'shoppingcart_audits'</i> table.</p>
								<pre><code>CREATE TRIGGER quantity_changes
BEFORE UPDATE
ON save_to_shopping_cart
FOR EACH ROW
EXECUTE PROCEDURE shoppingcart_quantity_changes();</code></pre>
								</ol>
								</div>
                                <!-- JAVA GUI -->
                                <h2 id="javaGUI">Java GUI</h2>
                                <p>We have created GUI for our database by Java. I am going to show you some functions and go through a little bit about our GUI.</p>
								<div class="6u$ 12u$(small)">
									<ol>
									<h6><i><li>Connect to Database</li></i></h6>
									<p>Before we perform any query to database, we need to make sure the connection with database is built in java. PostgreSQL JDBC Driver is required to do so. After downloading from <a href="https://jdbc.postgresql.org/download.html">PostgreSQL JDBC Driver</a>, dropping it into the classpath and following the below codes can successfully build the connection.</p>
									<pre><code>public class SQL {
    Statement statement;
    public SQL() throws SQLException{
        try {
            DriverManager.registerDriver ( new org.postgresql.Driver() ) ;
		} catch (Exception cnfe){
            System.out.println("Class not found");
            }	 
        String url = "jdbc:postgresql://comp421.cs.mcgill.ca:5432/cs421"; //The IP address of your database
        Connection con = DriverManager.getConnection (url, "Username", "Password") ;
        statement = con.createStatement (ResultSet.TYPE_SCROLL_SENSITIVE,ResultSet.CONCUR_UPDATABLE ) ;
        System.out.println("Build connection with database successfully");
}</code></pre>
                                    <p>Create a statement object so we can submit SQL statements to the driver. <code>Statement statement = con.createStatement();</code></p>
									<p>How to pass the SQL statement from java to database? The answer is mentioned above â€” statement object. But there are two different kinds of situation. First, you may perform data modification for the database and do not expect any value returned from it, such as <code>update</code>and <code>delete</code>. Second, you may perform query which would return the data from database. Two corresponding methods in java are shown below:</p>
									<pre><code>public void WriteExcute(String sqlCode){
    try {
        statement.executeUpdate ( sqlCode ) ;
        System.out.println("Write excute the code "+sqlCode);
    } catch (SQLException e){
        int errorCode = e.getErrorCode(); // Get SQLCODE
        String sqlState = e.getSQLState(); // Get SQLSTATE     
        System.out.println("Code: " + sqlCode + "  sqlState: " + sqlState);
    }
}
		
public java.sql.ResultSet QueryExchte(String sqlCode){ 
    java.sql.ResultSet rs = null;
    try {
        rs = statement.executeQuery (sqlCode ) ;
        System.out.println("Query excute the code "+sqlCode);
    } catch (SQLException e){
        int errorCode = e.getErrorCode(); // Get SQLCODE
        String sqlState = e.getSQLState(); // Get SQLSTATE     
        System.out.println("Code: " + sqlCode + "  sqlState: " + sqlState);
        }
    return rs; //rs contains the results of the execution of a query
}</code></pre>
                                        <!-- Execute SQL -->
                                        <h6><i><li>Execute SQL statements</li></i></h6>
									<p>Actually, different functions, including Login, Search products, Purchase, and Delivery, are all achieved by executing different SQL statements in the application. We used Swing and AWT to create each user-friendly frame. The working flow of our application is shown below:</p>
                                    <div class="6u$ 12u$(small)">
                                        <ol>
                                    <li><p>Main frame for user to choose various functions when they first open the application. At this time, user can only log in or register as a user.</p></li>
                                    <img class = "image fit" src="images/database/MainFrame.png" alt="" />
                                    <li><p>User registration interface.</p></li>
                                    <img class = "image fit" src="images/database/Register.png" alt="" />
                                    <li><p>User log in interface.</p></li>
                                    <img class = "image fit" src="images/database/Login.png" alt="" />
                                    <li><p>This is the main frame after user successfully logged in or registered. Now the login and register buttons are unenable.</p></li>
                                    <img class = "image fit" src="images/database/Afterlogin.png" alt="" />
                                    <li><p>Add address for delivery.</p></li>
                                    <img class = "image fit" src="images/database/Add%20Addr.png" alt="" />
                                    <li><p>Search products.</p></li>
                                    <img class = "image fit" src="images/database/Search%20Prod.png" alt="" />
                                    <li><p>Add products into shopping cart</p></li>
                                    <img class = "image fit" src="images/database/Add%20to%20cart.png" alt="" />
                                    <li><p>View shopping cart</p></li>
                                    <img class = "image fit" src="images/database/View%20Shoppingcart.png" alt="" />
                                    <li><p>Select a delivery address.</p></li>
                                    <img class = "image fit" src="images/database/Select%20Addr.png" alt="" />
                                            </ol>
                                        </div>
									</ol>
                                    <h2 id="end">The thing you don't wanna miss</h2>
                                    <p>You can find everything about this project at <a href="https://github.com/aaronzguan/ECSE421-Project">Git Hub</a>.</p>
                                </div>
								<footer class="actions">
									<a href="things-i've-made.html" class="button big">BACK</a>
								</footer>
                        </article>
                        </div>
					</div>

			</div>
        <!-- Footer -->
        <div id="footer" align="center">
            <ul class="icons"> 
                <li><a href="https://www.facebook.com/profile.php?id=100004606699026" class="fa-facebook"><span class="label">Facebook</span></a></li>
                <li><a href="https://www.instagram.com/mraaronever/" class="fa-instagram"><span class="label">Instagram</span></a></li>
                <li><a href="https://www.youtube.com/channel/UCbl3QhmOwDUxx3JBIaQ8QyA" class="fa-youtube"><span class="label">Youtube</span></a></li>
                <li><a href="mailto:aaron.z.guan@hotmail.com" class="fa-envelope"><span class="label">Email</span></a></li>
                <li><a href="https://github.com/aaronzguan" class="fa-github"><span class="label">GitHub</span></a></li>
                <li><a href="https://www.linkedin.com/in/zhongguan/" class="fa-linkedin"><span class="label">LinkedIn</span></a>
            </ul>
            <p class="copyright">Copyright &copy; <a href="index.html">Aaron Z Guan</a> 2017.</p>
        </div>
        
        <!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>

	</body>
</html>
